<!doctype html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>html压缩算法</title>
	</head>
	<body>
	<div id="source" style="display:none;">
		<div spellcheck =   " 0" class  = "   editMode">
			<p>
				<span style = "font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Asdf</span>
				<span style = "font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">asdfaf</span>
				  <span style = "font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">aasdfa</span>
				  <span style =  "font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">sdfas</span>
				  <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">dfa</span>
				  <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">sdfa</span>
				  <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">sdf</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				  <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">asd</span>
				  <span style="color:rgb(0,0,255);font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">faSDFasdfasdf</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				  <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Asdasdfsd</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				  <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Fas</span>
			</p>
			<p>   <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;background:rgb(255,255,0);font-family:'宋体';" class="Apple-style-span">Faasdfasdafsdsadfasdasdfadsfasdfsaf</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				 <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>     <span style="font-size:10.5000pt;background:rgb(255,255,0);font-family:'宋体';" class="Apple-style-span">Sfasdfasd</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
			 <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>	    <span style="font-size:10.5000pt;background:rgb(255,255,0);font-family:'宋体';" class="Apple-style-span">Asasfddwsf</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
			 <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>	 <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>   <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				   <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Asdf</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				    <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Asdfasdfasdfa</span>
			</p>
			<p style="text-align:left;">
				   <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Asdasdfasdfasdfasalsdfkjasdlkfjf</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				   <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Asdf</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				  <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">A</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				   <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sdf</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				  <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Asf</span>
			</p>
			<p> <span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">Sf</span>
				<span style="font-size:10.5000pt;font-family:'宋体';" class="Apple-style-span">asfasdfasdfasd</span>
			</p>
		</div>
	</div>
	
	<script>
		var text = document.getElementById('source').innerHTML;
		
		function comple (text){
			//第一步做最基本的替换
			console.log('原字符长度',text.length);
			text = text.replace(/\s{2,}/g,' ').replace(/(^\s+|\s+$)/gm,'').replace(/(>)(\s+)(<)/g,"$1$3");
			//text = text.replace(/\s*=\s*(['"])/g,"=$1");
			console.log('第一步长度',text.length);
			console.log(text);
			var cache ={};
			var cache2={};
			var dic = text.match(/\b[-_=\.\u4E00-\u9FA50-9a-zA-Z:;><]{2,}\b/g);
			var dics = [];
			console.log(dic);
			var tmp ='';
			for(var len = dic.length-1;len>=0;len--){
				cache[dic[len]] || (cache[dic[len]] =0);
				cache[dic[len]]++;
			}
			
			for(var p in cache){
				dics.push(p);
				tmp+=':'+p;
			}
			
			dics.sort(function(a,b){
				if (a.length > b.length){
						return 1;
				}
				return -1;
			});
			
			var arr='a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,A,B,C,D,E,F,I,G,J,K'.split(',')
			
			for(var len=dics.length-1;len>=0;len--){
				var reg = new RegExp('\\b'+dics[len]+'\\b','g'); 
				text=text.replace(reg,'A'+arr.pop()); 
			}
			var ts=text.match(/[\u4E00-\u9FA5]+/g);
			console.log(ts);
			
			
			
			text+=tmp;
			return text;
		}
		text = comple(text);
		
		console.log(text,text.length);
		
	</script>
	
	</body>
</html>
